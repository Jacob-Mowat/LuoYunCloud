<%inherit file="/base.html"/>

<%block name="head">
<link rel="stylesheet" href="${THEME_URL}instance.css" />
<link rel="stylesheet" href="${THEME_URL}button.css" />
<script type="text/javascript" src="${STATIC_URL}js/url.js"></script>
<script type="text/javascript" src="${STATIC_URL}js/instance.js"></script>

</%block>


<%block name="main">

<div class="inner-nav c">
  <ol>
    <li><a class="home" href="/">${ _("Home") }</a></li>
    <li><a href="/instance">${ _("Instances") }</a></li>
    <li><span>${ instance.name }</span></li>
  </ol>
</div>

<div class="island c" id="instance-show-main">

  <ul>
    <li class="c1">
      <div id="iview-ilogo">
	<a href="${ reverse_url('instance:view', instance.id) }"><img src="${ instance.logourl }" /></a>
      </div>
    </li>

    <li class="c2">
      <div id="iview-domain">
	% if instance.domain:
	% if instance.is_running:
	<a href="${ instance.home_url(current_user) }" target="_blank">${ instance.domain }</a>
	% else:
	${ instance.domain }
	% endif
	% endif
      </div>
      <div id="iview-ip">
	% if instance.work_ip:
	<a href="${ instance.home_url(current_user) }" target="_blank"><span id="lyinst-ip">${ instance.work_ip }</span></a>
	% endif
      </div>
      <div id="iview-task-result">
      </div>
    </li>
    
    <li class="c3">
      <table>
	<tbody>
          <tr>
            <td class="c1">${ _("Owner") }</td>
            <td class="c2"><a href="${ reverse_url('account:view', instance.user_id) }">${ instance.user.username }</a></td>
          </tr>
          <tr>
            <td class="c1">${ _("Appliance") }</td>
            <td class="c2"><a href="${ reverse_url('appliance:view', instance.appliance.id) }">${ instance.appliance.name }</a></td>
          </tr>
          <tr>
            <td class="c1">${ _("Create Time") }</td>
            <td class="c2">${ fulltime(instance.created) }</td>
          </tr>
          <tr>
            <td class="c1">${ _("Update Time") }</td>
            <td class="c2">${ fulltime(instance.updated) }</td>
          </tr>
	  <tr>
	    <td class="c1">${ _("Lastest Job") }</td>
	    <td class="c2"><span id="lyjob-id">${ instance.lastjob_id }</span></td>
	  </tr>
	</tbody>
      </table>
    </li>
  </ul>
</div>

<div class="c"></div>
<div id="instance-status-show" class="ly-box c">
  <ul>
    <li id="iview-inst-control-btn">
      % if (current_user and current_user.id == instance.user_id) or has_permission('admin'):
      % if instance.can_run:
      <a href="${ reverse_url('instance:control', instance.id) }?action=run" title="${ _('run instance') }"><img src="${ theme_url('img/run-instance.png') }"/></a>
      % elif instance.need_query:
      <a href="${ reverse_url('instance:control', instance.id) }?action=query" title="${ _('query instance status') }"><img src="${ theme_url('img/query-instance.png') }"/></a>
      % else:
      <a href="${ reverse_url('instance:control', instance.id) }?action=stop" title="${ _('stop instance') }"><img src="${ theme_url('img/shutdown-instance.png') }"/></a>
      % endif
      % endif
    </li>
    <li class="right">
      <table>
	<tbody>
	  <tr>
	    <td><img id="lyinst-status-img" src="${ theme_url('icons/InstanceStatus/%s.png' % instance.status) }"/></td>
	    <td>
	      <span id="lyinst-status-str">${ instance.status_string }</span><span style="display:none;" id="lyinst-status-id">${ instance.status }</span>
	    </td>
	  </tr>
	  <tr>
	    <td><img id="lyjob-status-img" src="" /></td>
	    <td>
	      <span id="lyjob-status-str">${ instance.job_status_string }</span>
	      <span id="lyjob-status-id">${ instance.lastjob_status_id }</span>

	    </td>
	  </tr>
	</tbody>
      </table>
    </li>
  </ul>
</div>


<div class="c"></div>

<div id="i-main" class="ly-box c">
  <div id="inst-sidebar">
    % if current_user and current_user.id == instance.user_id:
    <div id="admin-menu" class="island c">
      <div class="head" id="admin-config-tool"><img src="${ THEME_URL }img/settings.png"/></div>
      <ul style="display:none;">
        <li><a class="current" href="/instance/${ instance.id }?view=baseinfo">${ _("Baseinfo") }</a></li>
        <li><a href="/instance/${ instance.id }?view=resource">${ _("Resource") }</a></li>
        <li><a href="/instance/${ instance.id }?view=network">${ _("Network") }</a></li>
        <li><a href="/instance/${ instance.id }?view=storage">${ _("Storage") }</a></li>
        <li><a href="/instance/${ instance.id }?view=secret">${ _("Secret") }</a></li>
        <li><a href="/instance/${ instance.id }?view=domain">${ _("Domain") }</a></li>
        <li><a href="/instance/${ instance.id }?view=webssh">${ _("WebSSH") }</a></li>
        <li><a href="/instance/${ instance.id }?view=delete">${ _("Delete") }</a></li>
        <li><a href="/instance/${ instance.id }?view=joblist">${ _("History") }</a></li>
      </ul>
    </div>
    % endif
  </div>
  <div id="inst-center">
    % if current_user and instance.ischanged and current_user.id == instance.user_id:
    <div class="ly-warning">${ _("Instance configuration has changed, please restart instance for new settings to be effective!") }</div>
    % endif
    <div id="admin-center" class="min-height-300">
      <%block name="maincenter"/>
    </div>
  </div>
</div>


<script type="text/javascript">
  InstanceControl();
  MenuClick();
  AdminMenuslide();
  InstanceStatusCheck("${ reverse_url('instance:status', instance.id) }", "${ reverse_url('instance:control_button', instance.id) }");
</script>

</%block>
